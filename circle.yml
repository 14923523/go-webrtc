machine:
  pre:
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.9 20
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-4.9 20

dependencies:
  pre:
    - sudo apt-get update; sudo apt-get install gcc-5; sudo apt-get install g++-5
    - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-5 100
    - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-5 100
  post:
    - go get -u github.com/jstemmer/go-junit-report

test:
  pre:
    - gcc --version
    - g++ --version
  override:
    - set -o pipefail
    - go test -v -race ./data | tee /dev/tty | go-junit-report > $CIRCLE_TEST_REPORTS/webrtc-data.xml
    - go test -v -race . | tee /dev/tty | go-junit-report > $CIRCLE_TEST_REPORTS/webrtc.xml
